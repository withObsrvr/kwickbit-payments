pipelines:
  KwickbitPaymentPipeline:
    source:
      type: SorobanSourceAdapter
      config:
        rpc_url: "https://stellar-soroban-testnet-public.nodies.app"
        auth_header: ""
        poll_interval: 4
        start_ledger: 1556742
        end_ledger: 1556743
        format: "xdrFormat"
        rpc_method: "getLedgers"
        num_workers: 10
        retry_limit: 3
        retry_wait: 5
    processors:
      - type: ContractEvent
        config:
          network_passphrase: "Test SDF Network ; September 2015"
      - type: ContractFilter
        config:
          network_passphrase: "Test SDF Network ; September 2015"
          contract_id: "CCQBTIFXJ6RE43YSQDGWNXBMVLBRKVBAIE3IE6225T4LLO374RNTPS5G"
      - type: EventPaymentExtractor
        config:
          network_passphrase: "Test SDF Network ; September 2015"
    consumers:
      - type: SaveEventPaymentToPostgreSQL
        config:
          host: "${DB_HOST}"
          port: 5432
          database: "${DB_DATABASE}"
          username: "postgres"
          password: "${DB_PASSWORD}"
          sslmode: "disable"
          max_open_conns: 10
          max_idle_conns: 5
      - type: PublishToGooglePubSub
        config:
          project_id: "${PUBSUB_PROJECT_ID}"
          topic_id: "payments"
          # Credentials from env var: GCLOUD_PUBSUB_PUBLISHER_SERVICE_ACCOUNT_KEY
          # Or use: credentials_file: "/path/to/service-account.json"
          # For local testing with emulator: export PUBSUB_EMULATOR_HOST=localhost:8085
